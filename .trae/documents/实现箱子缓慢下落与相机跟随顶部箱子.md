## 目标
- 箱子从画布最上方缓慢下落，与已有箱子准确碰撞并稳定叠放。
- 当叠到第 3 个箱子后，画面开始跟随，保持“当前最上方的箱子”在一个固定屏幕 Y 位置（如 `fixedTopY = 120`）。

## 现状与切入点
- 渲染：`src/components/GameCanvas.tsx:40–161` 使用 `requestAnimationFrame` 绘制所有对象；无全局相机。
- 物理：`src/PhysicsEngine.ts:8–21` 基于毫秒 `deltaTime` 更新重力/速度；叠堆与碰撞已实现（`59–102`）。
- 游戏循环：`src/App.tsx:50–114` 管理 `fallingBox`、`boxes` 和点击/鼠标输入；可在此启用跟随条件。

## 实现方案
- 物理时间归一化：将 `deltaTimeMs` 转换为秒，重力按“像素/秒²”计算，获得更平滑的与帧率无关的“慢速下落”。
- 顶部箱子计算：以“箱子顶部”`topY = box.y - box.height / 2` 判定最高（最小 `topY`）或直接使用最后静止箱子（若逻辑总是把新落地箱子推入末尾）。
- 相机偏移：在 `GameCanvas` 绘制前应用一次 `ctx.translate(0, cameraOffsetY)`，所有世界坐标绘制都受此影响（地面、箱子、预览、粒子）。
- 跟随条件：`boxes.length >= 3` 时启用相机；目标是让最高箱子的 `topY` 映射到固定屏幕位置 `fixedTopY`。
- 平滑：使用线性插值 `cameraY = lerp(cameraY, desiredCameraY, 0.1)`，避免突兀跳动。
- UI 不跟随：结束遮罩与文案在 `ctx.restore()` 后绘制（屏幕坐标层）。
- 输入映射：仅 Y 方向平移，鼠标 X 不受影响；仍按画布局部坐标更新 `currentBoxX`。

## 伪代码
- `PhysicsEngine.updateBox(dtMs)`
  - `dtSec = dtMs / 1000`
  - `box.velocityY += GRAVITY * dtSec`
  - `box.velocityX *= FRICTION ** dtSec`
  - `box.y += box.velocityY * dtSec`
  - `box.x += box.velocityX * dtSec`
  - 地面/边界/碰撞保持现有逻辑
- `App.tsx` 状态
  - `const [cameraY, setCameraY] = useState(0)`
  - `const fixedTopY = 120`
  - 每帧计算：
    - 若 `boxes.length >= 3`：
      - `topBox = getTopBox(boxes)`
      - `desiredCameraY = fixedTopY - (topBox.y - topBox.height / 2)`
      - `cameraY = lerp(cameraY, desiredCameraY, 0.1)`
    - 否则 `cameraY = 0`
  - 通过 props 传给 `GameCanvas`
- `GameCanvas.render()`
  - `ctx.save()`
  - `ctx.translate(0, cameraY)`
  - 绘制地面、所有静止箱子、`fallingBox`、预览线、粒子（保持现有世界坐标逻辑）
  - `ctx.restore()`
  - 若 `gameOver`：绘制遮罩与文案（不受相机影响）

## 变更点（文件与位置）
- `src/PhysicsEngine.ts:8–21` 时间单位改为秒，并相应调整 `GRAVITY/FRICTION` 应用方式。
- `src/App.tsx:50–114` 游戏循环中加入 `cameraY` 计算与 `fixedTopY`，并作为 props 传递。
- `src/components/GameCanvas.tsx:40–71` 在帧开始处 `ctx.save()/translate()/restore()` 包裹世界绘制；遮罩与 UI 保持屏幕坐标。

## 验证
- 运行开发服务器，观察：
  - 单个箱子下落速度稳定且“慢速”，不同帧率下体验一致。
  - 叠放后碰撞无穿透，粒子与落地判断仍触发（参考 `onBoxLanded`）。
  - 叠到第 3 个后，画面开始平滑上移，确保最高箱子顶部稳定在 `fixedTopY`。
  - 游戏结束遮罩位置与尺寸不受相机影响。

## 兼容性与注意
- 仅沿 Y 方向平移，避免改变鼠标 X 输入与点击逻辑。
- 若需要更慢下落，可将 `GRAVITY` 调小（例如 `800 px/s²`），或在 `App.tsx` 投放时降低初始 `velocityY`。
- 粒子系统在相机变换后绘制，和世界坐标保持一致。